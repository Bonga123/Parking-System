@model IEnumerable<CarPacking.Models.QuoteRequest>

<link href="~/Content/quotecss.css" rel="stylesheet" />

@{
    ViewBag.Title = "View Quote Requests";
}

<div class="quote-body mt-5">
    <div class="quote-container">
        <h2 class="quote-title text-center">
            View Quote Requests
        </h2>

        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <th>Request ID</th>
                    <th>Request Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var quoteRequest in Model)
                {
                    <tr>
                        <td>@quoteRequest.QuoteRequestId</td>
                        <td>@quoteRequest.RequestDate.ToString("g")</td>
                        <td>@quoteRequest.Status</td>
                        <td>
                            @if (quoteRequest.Status == "Pending")
                            {
                                <a href="@Url.Action("SubmitQuote", "Supplier", new { quoteRequestId = quoteRequest.QuoteRequestId })" class="btn btn-primary">Submit Quote</a>
                            }
                            else
                            {
                                <span class="text-muted">Quote Submitted</span>
                            }
                            <button class="btn btn-info ml-2" data-toggle="modal" data-target="#quoteRequestModal"
                                    onclick="showQuoteRequestDetails(@quoteRequest.QuoteRequestId)">
                                View Requested Products
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Modal for displaying requested products -->
<div class="modal fade" id="quoteRequestModal" tabindex="-1" role="dialog" aria-labelledby="quoteRequestModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="quote-modal-content">
            <div class="quote-modal-header">
                <h5  id="quoteRequestModalLabel">Requested Products</h5>
                <button type="button" class="quote-close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="quote-modal-body">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Quantity</th>
                        </tr>
                    </thead>
                    <tbody id="modalRequestDetails">
                        <!-- Product details will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
            <div class="quote-modal-footer">
                <button type="button" class="quote-btn-custom" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    function showQuoteRequestDetails(quoteRequestId) {
        $.ajax({
            url: '@Url.Action("GetQuoteRequestDetails", "Admin")', // The controller action to fetch details
            type: 'GET',
            data: { id: quoteRequestId },
            success: function (data) {
                var modalBody = $('#modalRequestDetails');
                modalBody.empty(); // Clear existing content

                data.forEach(function (item) {
                    modalBody.append('<tr><td>' + item.ProductName + '</td><td>' + item.Quantity + '</td></tr>');
                });
            },
            error: function () {
                alert('Failed to load the requested products.');
            }
        });
    }
</script>

<style>
    /* Overall Body Styling */
    .quote-body {
       
        background-color: #f4f7f6;
        padding: 20px;
    }

    /* Container Styling */
    .quote-container {
        max-width: 1200px;
        margin: auto;
    }

    /* Table Styling */
    .table-striped tbody tr:nth-of-type(odd) {
        background-color: #f9f9f9;
    }

    .table-bordered {
        border: 1px solid #ddd;
    }

    .table th, .table td {
        text-align: center;
        vertical-align: middle;
    }

    /* Button Styling */
    .btn-info {
        background-color: #17a2b8;
        border-color: #17a2b8;
        color: #fff;
        transition: background-color 0.3s ease;
    }

        .btn-info:hover {
            background-color: #138496;
            border-color: #117a8b;
        }

    /* Modal Styling */
    .quote-modal-content {
        border-radius: 15px;
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #fff;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .quote-modal-header {
        border-bottom: none;
        text-align: center;
    }

        .quote-modal-header h5 {
            font-size: 1.8rem;
            margin: 0;
            font-weight: 700;
            color: #333;
        }

    .quote-modal-body {
        padding-top: 15px;
        padding-bottom: 15px;
    }

    .quote-modal-footer {
        border-top: none;
        text-align: right;
    }

    .quote-close {
        color: #aaa;
        opacity: 1;
        font-size: 1.2rem;
    }

        .quote-close:hover {
            color: #000;
        }

</style>