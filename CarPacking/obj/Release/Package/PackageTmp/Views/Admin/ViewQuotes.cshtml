@model IEnumerable<CarPacking.Models.Quote>

@{
    ViewBag.Title = "View Submitted Quotes";
    var firstQuote = Model.FirstOrDefault();
    var requestDate = firstQuote?.QuoteRequest?.RequestDate.ToString("g") ?? "N/A";
}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<h2>Submitted Quotes for Request @requestDate</h2>

@if (Model != null && Model.Any())
{
    <div class="quotes-container">
        @foreach (var quote in Model)
        {
            var supplierName = quote?.QuoteRequest?.Supplier?.Name ?? "Unknown Supplier";
            <div class="quote-card">
                <h4>Supplier: @supplierName</h4>
                <p>Date Submitted: @quote.QuoteDate.ToString("g")</p>
                <p>Total Price: @quote.TotalPrice.ToString("C")</p>

                @using (Html.BeginForm("ApproveQuote", "StockOrder", FormMethod.Post, new { id = "quoteForm-" + quote.QuoteId }))
                {
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="quoteId" value="@quote.QuoteId" />
                    <button type="button" class="btn btn-primary view-quote-details" data-quote-id="@quote.QuoteId">
                        View Quote Details
                    </button>
                    <button type="submit" class="btn btn-success">
                        Approve Quote and Create Stock Order
                    </button>
                }
            </div>
        }
    </div>
}
else
{
    <p>No quotes have been submitted for this request.</p>
}

<!-- Modal for viewing quote details -->
<div class="modal fade" id="quoteDetailsModal" tabindex="-1" aria-labelledby="quoteDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="quoteDetailsModalLabel">Quote Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="quoteDetailsModalBody">
                <!-- Quote details will be loaded here dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('.view-quote-details').forEach(button => {
            button.addEventListener('click', function () {
                var quoteId = this.getAttribute('data-quote-id');

                fetch(`@Url.Action("GetQuoteDetails", "StockOrder")?id=${quoteId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.text();
                    })
                    .then(data => {
                        document.getElementById('quoteDetailsModalBody').innerHTML = data;
                        $('#quoteDetailsModal').modal('show');
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                        alert('An error occurred while retrieving the quote details.');
                    });
            });
        });
    });
</script>

<style>
    /* Custom CSS for Quote View */

    .quotes-container {
        margin-top: 20px;
    }

    .quote-card {
        padding: 20px;
        margin-bottom: 20px;
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #ddd;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .quote-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .quote-card h4 {
            margin-top: 0;
            color: #333;
            font-weight: 600;
        }

        .quote-card p {
            margin: 5px 0;
            color: #555;
        }

        .quote-card .btn-primary {
            margin-top: 10px;
        }

    .modal-content {
        border-radius: 8px;
    }

    .modal-header {
        background-color: #007bff;
        color: white;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
    }

    .modal-title {
        font-weight: bold;
        color: #fff;
    }

    .modal-body table {
        margin-top: 15px;
    }

    .modal-footer {
        border-top: 1px solid #e9ecef;
    }

    .modal-lg {
        max-width: 80%;
    }

    .modal-header .close {
        color: #fff;
    }
</style>
